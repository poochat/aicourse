<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å…‰ä¼å‘ç”µåŠŸç‡æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="app-container">
    <header class="app-header">
        <h1>â˜€ï¸ å…‰ä¼å‘ç”µåŠŸç‡æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ</h1>
        <p>åŸºäºæ·±åº¦å­¦ä¹  Â· å®æ—¶é¢„æµ‹æœªæ¥1å°æ—¶å‘ç”µåŠŸç‡</p>
    </header>

    <div class="control-panel">
        <form method="get" class="model-form">
            <label for="model">é€‰æ‹©é¢„æµ‹æ¨¡å‹ï¼š</label>
            <select name="model" id="model" onchange="this.form.submit()">
                {% for m in available_models %}
                <option value="{{ m }}" {% if m == selected_model %}selected{% endif %}>{{ m }}</option>
                {% endfor %}
            </select>
        </form>
        <div class="status-badge">{{ selected_model }} æ¨¡å‹ Â· è¿è¡Œæ­£å¸¸</div>
    </div>

    <main class="dashboard">
        <!-- å½“å‰çŠ¶æ€ -->
        <section class="card current-status">
            <h2>å½“å‰ç”µç«™çŠ¶æ€</h2>
            <div class="info-grid">
                <div><span class="label">æ—¶é—´</span><span class="value">{{ current_time }}</span></div>
                <div><span class="label">å½“å‰åŠŸç‡</span><span class="value">{{ current_power }} kW</span></div>
                <div><span class="label">è£…æœºå®¹é‡</span><span class="value">{{ capacity }} kW</span></div>
                <div><span class="label">å½“å‰å®¹é‡å› å­</span><span class="value">{{ "%.1f"|format(current_power / capacity * 100) }}%</span></div>
            </div>
        </section>

        <!-- é¢„æµ‹ç»“æœ -->
        <section class="card prediction-result">
            <h2>âš¡ æœªæ¥1å°æ—¶é¢„æµ‹</h2>
            <div class="prediction-display">
                <div class="power-number">{{ pred_power }}<small>kW</small></div>
                <div class="capacity-factor">å®¹é‡å› å­ï¼š<strong>{{ "%.1f"|format(pred_power / capacity * 100) }}%</strong></div>
            </div>
            <button onclick="location.reload()" class="refresh-btn">ğŸ”„ åˆ·æ–°é¢„æµ‹</button>
        </section>

        <!-- æœ€è¿‘6å°æ—¶æ•°æ® -->
        <section class="card recent-data">
            <h2>ğŸ“Š æœ€è¿‘6å°æ—¶å®æµ‹æ•°æ®</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¶é—´</th>
                        <th>åŠŸç‡ (kW)</th>
                        <th>POA è¾ç…§ (W/mÂ²)</th>
                        <th>ç»„ä»¶æ¸©åº¦ (Â°C)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in recent_data %}
                    <tr>
                        <td>{{ "%02d"|format(row.hour) }}:00</td>
                        <td>{{ "%.2f"|format(row.power_kW) }}</td>
                        <td>{{ "%.1f"|format(row.poa_Wm2) }}</td>
                        <td>{{ "%.1f"|format(row.module_temp_C) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <!-- å†å²48å°æ—¶æ›²çº¿ -->
        <section class="card chart-section">
            <h2>ğŸ“ˆ æœ€è¿‘48å°æ—¶å‘ç”µåŠŸç‡è¶‹åŠ¿</h2>
            <div class="chart-container">
                <canvas id="powerChart"></canvas>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        Â© 2025 å…‰ä¼æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ | æ”¯æŒ LSTM / GRU / TCN / Transformer / CNN-LSTM å¤šæ¨¡å‹å¯¹æ¯”
    </footer>
</div>

<script>
    // æ¸²æŸ“å›¾è¡¨
    const ctx = document.getElementById('powerChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ history_labels | tojson }},
            datasets: [{
                label: 'å‘ç”µåŠŸç‡ (kW)',
                data: {{ history_values | tojson }},
                borderColor: '#4ade80',
                backgroundColor: 'rgba(74, 222, 128, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                pointRadius: 2,
                pointHoverRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#e5e7eb', font: { size: 12 } }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(30, 41, 59, 0.9)',
                    titleColor: '#fbbf24',
                    bodyColor: '#ffffff'
                }
            },
            scales: {
                x: {
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { color: '#d1d5db' }
                },
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255,255,255,0.1)' },
                    ticks: { color: '#d1d5db' }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
</script>
</body>
</html>